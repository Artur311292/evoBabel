### author webber (web-ber12@yandex.ru)


### evoBabel - новый велосипед для мультиязычных сайтов на MODx Evo

### Состав:
---------
* 1. Папка assets/snippets/evoBabel, содержащая основной сниппет snippet.evoBabel.php (создание языковых версий) и необходимый для работы файл functions.evoBabel.php
* 2. Библиотеку MODxAPi от AgelNash (https://github.com/AgelxNash/resourse) для быстрого и удобного создания и копирования ресурсов вместе с ТВ
* 3. Сниппет evoBabel - для вывода результатов работы в ТВ ресурса
* 4. Сниппет switchLang - для вывода переключателей языков и чтения перевода текущего языка
* 5. Сниппет lang - для выдачи перевода на нужном языке на сайте
* 6. Плагин evoBabel - для правильной отдачи 404 страницы и синхронизации значений выбранных ТВ
* 7. Модуль lexicon для evoBabel (файлы и текст модуля)


### Возможности:
---------
* 1. создание неграниченного количества языковых версий сайта
при этом каждая версия хранится в своем дереве, что не ограничивает нас никак
т.е. структура сайта на разных языках может отличаться (в отличие от YAMS), нет проблем с плейсхолдерами, другими сниппетами и т.п.
* 2. ресурсы разных языковых версий связаны между собой - что позволяет при навигации переключаться на нужную языковую версию ресурса
(за это отвечает сниппет switchLang)
* 3. Возможна синхронизация значений нужных ТВ параметров для разных версий ресурса (id нужных ТВ задается в настройках плагина evoBabel)
* 4. Переводы в отдельном модуле Lexicon без перезагрузки и сразу для всех языков. Есть фильтрация, возможность добавления и удаления нужного языка там же


### Установка:
---------
* 1. Скачиваем архив со сниппетом
* 2. Помещаем в папку assets/libs/ и assets/snippets/ соответствующие папки
* 3. Создаем шаблон "Язык" и запоминаем его id - мы будем присваивать его каждой корневой папке языка
* 4. Создаем в корне сайта один (или несколько) папок для языков - например RU,EN и т.п. с шаблоном "Язык". Алиасы данных папок будут алиасами языков (ru,en,fr и т.п.)
* 5. Пусть у нас основным языком будет RU, создаем в папке RU главную страницу (задаем ее стартовой для сайта в конфигурации MODx)
* 6. ID данной страницы вносим в поле description нашего ресурса RU, поле longtitle ресурса RU пишем слово "Русский" - там будет содержаться название нашего языка для вывода в переключалке языков
* 7. Создаем новый сниппет evoBabel и помещаем в него код из файла snippet.evoBabel.inc.txt
* 8. На вкладке Свойства данного сниппета в поле "Значение по умолчанию" копируем текст настроек &lang_template_id=id шаблона языка;text;11 и вносим в появившееся поле нужный нам id шаблона языка
* 9. Создаем новый сниппет switchLang, копируем текст из файла snippet.switchLang.inc.txt
* 10. Опять же на вкладке Свойства в параметры по умолчанию прописываем настройки &lang_template_id=id шаблона языка;text;11 &currlang=язык по умолчанию;text;ru и задаем нужный шаблон языка и название языка по умолчанию согласно алиасу корневой папки
* 11. Создаем новый сниппет lang и копируем код из файла snippet.lang.inc.txt (у него нет никаких доп.настроек)
* 12. Создаем новый плагин evoBabel, копируем код из файла plugin.evoBabel.inc.txt
* 13. В конфигурации плагина вставляем &synch_TV=ids TV для синхронизации;text;19,8,5,21,18,17,20,16,22 &synch_template=ids шаблонов для синхронизации;text;7 и указываем нужный шаблон и нужные id TV для синхронизации через запятую
* 14. Системные события для плагина OnPageNotFound, OnDocFormSave, OnBeforeEmptyTrash, OnEmptyTrash
* 15. Создаем новый модуль evoBabelLexicon и помещаем в него код файла module.Lexicon.inc.txt

* Осталось совсем чуть-чуть

* 16. Создаем новый ТВ-параметр (назовем его relation, заголовок - Языковые версии ресурса) с типом ввода Custom Input и в поле возможные значения вписываем код @EVAL return $modx->runSnippet("evoBabel");
* 17. Прикрепляем данный ТВ ко всем шаблонам кроме Языка.


Настройка админки завершена. Теперь в каждом ресурсе мы должны получить в поле Языковые версии ресурса мы должны получить название текущего языка и список доступных языков.
Если перевод уже создан  - то будет кнопка "перейти", если еще нет - кнопка "создать".


### Использование на сайте - тут вообще все просто
---------
* 1. В самом верху сайта на всех шаблонах (а лучше в общем чанке Header) вызываем наш сниппет [[switchLang? &id=`[*id*]`]]
Он сформирует список текущего и доступных языков, а также запишет их в плейсхолдер, плюс запишет в сессию переводы для текущего языка
* 2. В нужном месте шаблона размещаем плейсхолдеры [+activeLang+] - для отдельного вывода текущего языка и [+switchLang+] - для вывода переключалки языков
* 3. Сами переводы в шаблонах и чанках получаем с помощью сниппета lang
//использование в шаблонах чанках и т.п.
// [[lang? &a=`Главная страница`]] - выведет перевод слов Главная страница для текущего языка из его чанка
// использование в сниппетах 
// [[DocLister? &parents=`[[lang? &a=`Папка каталог`]]` ...другие параметры ..]]
//


### Пример работы
---------
<a href="http://evoBabel.sitex.by">Пример работы</a>

### Предупреждения и ограничения:
---------
* 1. Модуль поставляется "как есть", перед установкой изучите инструкцию и сделайте дамп базы сайта
* 2. При запуске модуля создается новая таблица "префикс_lexicon" в базе данных.
* 3. Поле description ресурса используется для хранения языковых связей. Если вы используете данное поле для других целей - предварительно необходимо вынести информацию из него в другое поле либо в TV параметр














